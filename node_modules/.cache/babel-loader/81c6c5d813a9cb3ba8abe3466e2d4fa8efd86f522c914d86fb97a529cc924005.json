{"ast":null,"code":"import React,{createContext,useState,useContext,useCallback,useEffect}from'react';import axios from'axios';import{useNavigate}from'react-router-dom';import{jsx as _jsx}from\"react/jsx-runtime\";const API_BASE_URL=process.env.REACT_APP_API_BASE_URL;const NotificacaoContext=/*#__PURE__*/createContext();export const useNotificacoes=()=>useContext(NotificacaoContext);export const NotificacaoProvider=_ref=>{let{children}=_ref;const[unreadCount,setUnreadCount]=useState(0);const[isLoadingCount,setIsLoadingCount]=useState(true);const navigate=useNavigate();const fetchUnreadCount=useCallback(async()=>{const token=localStorage.getItem('access_token');if(!token){setUnreadCount(0);setIsLoadingCount(false);return;}try{const response=await axios.get(\"\".concat(API_BASE_URL,\"/api/notificacoes/?lida=false\"),{headers:{'Authorization':\"Bearer \".concat(token)}});if(Array.isArray(response.data)){setUnreadCount(response.data.length);}else if(response.data&&typeof response.data.count==='number'){setUnreadCount(response.data.count);}else{setUnreadCount(0);}}catch(err){console.error('Erro detalhado em fetchUnreadCount:',err);if(err.response&&err.response.status===401){localStorage.removeItem('access_token');localStorage.removeItem('refresh_token');localStorage.removeItem('user_id');setUnreadCount(0);navigate('/login',{replace:true});}}finally{setIsLoadingCount(false);}},[navigate]);// Busca inicial\nuseEffect(()=>{fetchUnreadCount();},[fetchUnreadCount]);const decrementUnreadCount=useCallback(()=>{setUnreadCount(prevCount=>prevCount>0?prevCount-1:0);},[]);const value={unreadCount,isLoadingCount,fetchUnreadCount,decrementUnreadCount};return/*#__PURE__*/_jsx(NotificacaoContext.Provider,{value:value,children:children});};","map":{"version":3,"names":["React","createContext","useState","useContext","useCallback","useEffect","axios","useNavigate","jsx","_jsx","API_BASE_URL","process","env","REACT_APP_API_BASE_URL","NotificacaoContext","useNotificacoes","NotificacaoProvider","_ref","children","unreadCount","setUnreadCount","isLoadingCount","setIsLoadingCount","navigate","fetchUnreadCount","token","localStorage","getItem","response","get","concat","headers","Array","isArray","data","length","count","err","console","error","status","removeItem","replace","decrementUnreadCount","prevCount","value","Provider"],"sources":["C:/Users/milen/Desktop/4ยบ ano/projeto/ProjetoDrGus/frontend/src/context/NotificacaoContext.js"],"sourcesContent":["import React, { createContext, useState, useContext, useCallback, useEffect } from 'react';\r\nimport axios from 'axios';\r\nimport { useNavigate } from 'react-router-dom';\r\n\r\nconst API_BASE_URL = process.env.REACT_APP_API_BASE_URL;\r\n\r\nconst NotificacaoContext = createContext();\r\n\r\nexport const useNotificacoes = () => useContext(NotificacaoContext);\r\n\r\nexport const NotificacaoProvider = ({ children }) => {\r\n    const [unreadCount, setUnreadCount] = useState(0);\r\n    const [isLoadingCount, setIsLoadingCount] = useState(true);\r\n    const navigate = useNavigate(); \r\n\r\n    const fetchUnreadCount = useCallback(async () => {\r\n        const token = localStorage.getItem('access_token');\r\n\r\n        if (!token) {\r\n            setUnreadCount(0);\r\n            setIsLoadingCount(false);\r\n            return;\r\n        }\r\n\r\n        try {\r\n            const response = await axios.get(`${API_BASE_URL}/api/notificacoes/?lida=false`, { \r\n                headers: { 'Authorization': `Bearer ${token}` }\r\n            });\r\n            if (Array.isArray(response.data)) {\r\n                 setUnreadCount(response.data.length); \r\n            } else if (response.data && typeof response.data.count === 'number') {\r\n                 setUnreadCount(response.data.count);\r\n            } else {\r\n                 setUnreadCount(0); \r\n            }\r\n\r\n        } catch (err) {\r\n            console.error('Erro detalhado em fetchUnreadCount:', err); \r\n             if (err.response && err.response.status === 401) {\r\n                 localStorage.removeItem('access_token'); localStorage.removeItem('refresh_token'); localStorage.removeItem('user_id'); setUnreadCount(0); navigate('/login', { replace: true }); \r\n             }\r\n        } finally {\r\n            setIsLoadingCount(false);\r\n        }\r\n    }, [navigate]);\r\n\r\n    // Busca inicial\r\n    useEffect(() => {\r\n        fetchUnreadCount();\r\n    }, [fetchUnreadCount]); \r\n\r\n    const decrementUnreadCount = useCallback(() => {\r\n        setUnreadCount(prevCount => (prevCount > 0 ? prevCount - 1 : 0));\r\n    }, []); \r\n\r\n    const value = {\r\n        unreadCount,        \r\n        isLoadingCount,    \r\n        fetchUnreadCount,   \r\n        decrementUnreadCount \r\n    };\r\n\r\n    return (\r\n        <NotificacaoContext.Provider value={value}>\r\n            {children}\r\n        </NotificacaoContext.Provider>\r\n    );\r\n};"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}