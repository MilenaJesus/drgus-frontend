{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\milen\\\\Desktop\\\\4\\xBA ano\\\\projeto\\\\ProjetoDrGus\\\\frontend\\\\src\\\\componentes\\\\Topo.js\",\n  _s = $RefreshSig$();\nimport React, { useState, useEffect, useCallback, useRef } from 'react';\nimport { useLocation, Link } from 'react-router-dom';\nimport axios from 'axios';\nimport './Topo.css';\nimport { useNotificacoes } from '../context/NotificacaoContext';\nimport { formatDistanceToNow } from 'date-fns';\nimport ptBR from 'date-fns/locale/pt-BR';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst API_BASE_URL = process.env.REACT_APP_API_BASE_URL;\n\n// Mapeamento dos títulos das páginas (ajuste conforme suas rotas)\nconst pageTitles = {\n  '/inicio': 'Início',\n  '/pacientes': 'Pacientes',\n  '/patients/new': 'Novo Paciente',\n  // Ajustado para corresponder à rota\n  '/patients/:id': 'Detalhes do Paciente',\n  // Mantém o padrão genérico\n  '/patients/:id/edit': 'Editar Paciente',\n  // Adicionada rota de edição\n  '/agenda': 'Agenda',\n  '/orcamentos': 'Orçamentos',\n  '/pagamentos': 'Pagamentos',\n  '/notificacoes': 'Notificações'\n};\nfunction Header() {\n  _s();\n  const location = useLocation();\n  // Pega dados e funções do Contexto de Notificações\n  const {\n    unreadCount,\n    fetchUnreadCount,\n    isLoadingCount\n  } = useNotificacoes();\n\n  // Estados locais para o dropdown\n  const [isDropdownOpen, setIsDropdownOpen] = useState(false);\n  const [recentNotifications, setRecentNotifications] = useState([]);\n  const [isLoadingDropdown, setIsLoadingDropdown] = useState(false);\n\n  // Ref para o container do dropdown (para detectar cliques fora)\n  const dropdownRef = useRef(null);\n\n  // Função para buscar as notificações recentes NÃO LIDAS\n  const fetchRecentNotifications = useCallback(async () => {\n    // Não busca se não houver não lidas ou se já estiver buscando\n    if (unreadCount === 0 || isLoadingDropdown) {\n      setRecentNotifications([]);\n      return;\n    }\n    setIsLoadingDropdown(true);\n    const token = localStorage.getItem('access_token');\n    if (!token) {\n      setIsLoadingDropdown(false);\n      return;\n    }\n    try {\n      // Busca as X mais recentes não lidas (ex: limit=5)\n      const response = await axios.get(`${API_BASE_URL}/api/notificacoes/?lida=false&limit=5`, {\n        headers: {\n          'Authorization': `Bearer ${token}`\n        }\n      });\n      const notificationsData = response.data.results || (Array.isArray(response.data) ? response.data : []);\n      setRecentNotifications(notificationsData);\n    } catch (error) {\n      console.error(\"Erro ao buscar notificações recentes:\", error);\n      setRecentNotifications([]); // Limpa em caso de erro\n      // Tratar erro 401 (opcional aqui, já tratado no context)\n    } finally {\n      setIsLoadingDropdown(false);\n    }\n  }, [unreadCount, isLoadingDropdown]); // Adicionado isLoadingDropdown como dependência\n\n  // Função para abrir/fechar o dropdown\n  const toggleDropdown = () => {\n    const nextState = !isDropdownOpen;\n    setIsDropdownOpen(nextState);\n    // Busca notificações ao abrir (se houver não lidas)\n    if (nextState && unreadCount > 0) {\n      fetchRecentNotifications();\n    }\n  };\n\n  // Função para marcar todas como lidas\n  const handleMarkAllRead = async () => {\n    // Verifica se há algo para marcar\n    if (unreadCount === 0) {\n      setIsDropdownOpen(false); // Fecha o dropdown se já estiver vazio\n      return;\n    }\n    try {\n      const token = localStorage.getItem('access_token');\n      if (!token) throw new Error(\"Token não encontrado\");\n\n      // Chama o novo endpoint do backend usando POST\n      await axios.post(`${API_BASE_URL}/api/notificacoes/marcar-todas-como-lidas/`, {},\n      // Corpo da requisição vazio, pois a ação não precisa de dados extras\n      {\n        headers: {\n          'Authorization': `Bearer ${token}`\n        }\n      });\n\n      // Após sucesso:\n      fetchUnreadCount(); // Pede ao Contexto para atualizar a contagem global (deve ir para 0)\n      setRecentNotifications([]); // Limpa a lista local no dropdown\n      setIsDropdownOpen(false); // Fecha o dropdown\n    } catch (error) {\n      var _error$response;\n      console.error(\"Erro ao marcar todas como lidas:\", ((_error$response = error.response) === null || _error$response === void 0 ? void 0 : _error$response.data) || error.message);\n      alert(\"Erro ao marcar notificações como lidas. Verifique o console.\");\n      // Não fecha o dropdown em caso de erro para o usuário ver\n    }\n  };\n\n  // Efeito para fechar dropdown ao clicar fora\n  useEffect(() => {\n    const handleClickOutside = event => {\n      // Verifica se o clique foi fora do elemento referenciado pelo dropdownRef\n      if (dropdownRef.current && !dropdownRef.current.contains(event.target)) {\n        setIsDropdownOpen(false);\n      }\n    };\n    if (isDropdownOpen) {\n      document.addEventListener('mousedown', handleClickOutside);\n    } else {\n      document.removeEventListener('mousedown', handleClickOutside);\n    }\n    return () => {\n      // Limpeza ao desmontar\n      document.removeEventListener('mousedown', handleClickOutside);\n    };\n  }, [isDropdownOpen]);\n\n  // Função para formatar tempo relativo\n  const formatTempoAtras = dateString => {\n    try {\n      const date = new Date(dateString);\n      return formatDistanceToNow(date, {\n        addSuffix: true,\n        locale: ptBR\n      });\n    } catch (e) {\n      console.error(\"Erro formatando data:\", dateString, e);\n      return dateString;\n    }\n  };\n\n  // Função para pegar o título da página (ajustada para rotas dinâmicas)\n  const getPageTitle = () => {\n    let title = 'DrGus'; // Título padrão\n    // Verifica rotas exatas primeiro\n    if (pageTitles[location.pathname]) {\n      title = pageTitles[location.pathname];\n    } else {\n      // Verifica rotas com parâmetros (ex: /patients/:id)\n      for (const path in pageTitles) {\n        if (path.includes(':')) {\n          // Cria uma regex a partir do padrão da rota\n          // Ex: /patients/:id vira /patients/[^/]+\n          const regexPath = new RegExp(`^${path.replace(/:\\w+/g, '[^/]+')}$`);\n          if (regexPath.test(location.pathname)) {\n            title = pageTitles[path];\n            break; // Encontrou, pode parar\n          }\n        }\n      }\n    }\n    return title;\n  };\n  const currentPageTitle = getPageTitle();\n  return /*#__PURE__*/_jsxDEV(\"header\", {\n    className: \"app-header-common\",\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"page-title\",\n      children: currentPageTitle\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 162,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"notification-icon-wrapper\",\n      ref: dropdownRef,\n      children: [/*#__PURE__*/_jsxDEV(\"button\", {\n        type: \"button\",\n        className: \"notification-icon-button\",\n        onClick: toggleDropdown,\n        \"aria-label\": \"Abrir notifica\\xE7\\xF5es\",\n        \"aria-haspopup\": \"true\",\n        \"aria-expanded\": isDropdownOpen,\n        children: [/*#__PURE__*/_jsxDEV(\"i\", {\n          className: \"bx bxs-bell\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 167,\n          columnNumber: 21\n        }, this), \" \", !isLoadingCount && unreadCount > 0 && /*#__PURE__*/_jsxDEV(\"span\", {\n          className: \"notification-badge\",\n          children: unreadCount > 9 ? '9+' : unreadCount\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 170,\n          columnNumber: 26\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 166,\n        columnNumber: 17\n      }, this), isDropdownOpen && /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"notification-dropdown\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"dropdown-header\",\n          children: [/*#__PURE__*/_jsxDEV(\"span\", {\n            children: \"Notifica\\xE7\\xF5es Recentes\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 178,\n            columnNumber: 29\n          }, this), !isLoadingDropdown && recentNotifications.length > 0 && /*#__PURE__*/_jsxDEV(\"button\", {\n            onClick: handleMarkAllRead,\n            className: \"mark-all-read-button\",\n            children: \"Marcar todas como lidas\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 181,\n            columnNumber: 33\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 177,\n          columnNumber: 25\n        }, this), /*#__PURE__*/_jsxDEV(\"ul\", {\n          className: \"notification-list\",\n          children: isLoadingDropdown ? /*#__PURE__*/_jsxDEV(\"li\", {\n            className: \"notification-item loading\",\n            children: \"Carregando...\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 188,\n            columnNumber: 33\n          }, this) : recentNotifications.length > 0 ? recentNotifications.map(notif => /*#__PURE__*/_jsxDEV(\"li\", {\n            className: \"notification-item\",\n            children: /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"notification-link\",\n              children: [\" \", /*#__PURE__*/_jsxDEV(\"p\", {\n                className: \"notification-message\",\n                children: notif.mensagem\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 193,\n                columnNumber: 49\n              }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n                className: \"notification-time\",\n                children: formatTempoAtras(notif.data_criacao)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 194,\n                columnNumber: 49\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 192,\n              columnNumber: 45\n            }, this)\n          }, notif.id_notificacao, false, {\n            fileName: _jsxFileName,\n            lineNumber: 191,\n            columnNumber: 37\n          }, this)) : /*#__PURE__*/_jsxDEV(\"li\", {\n            className: \"notification-item empty\",\n            children: \"Nenhuma notifica\\xE7\\xE3o nova.\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 199,\n            columnNumber: 33\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 186,\n          columnNumber: 25\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"dropdown-footer\",\n          children: /*#__PURE__*/_jsxDEV(Link, {\n            to: \"/notificacoes\",\n            onClick: () => setIsDropdownOpen(false),\n            children: \"Ver todas as notifica\\xE7\\xF5es\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 204,\n            columnNumber: 30\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 202,\n          columnNumber: 26\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 176,\n        columnNumber: 21\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 165,\n      columnNumber: 13\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 161,\n    columnNumber: 9\n  }, this);\n}\n_s(Header, \"1EeXG7iXuEJw0hhPae73j2GBlEU=\", false, function () {\n  return [useLocation, useNotificacoes];\n});\n_c = Header;\nexport default Header;\nvar _c;\n$RefreshReg$(_c, \"Header\");","map":{"version":3,"names":["React","useState","useEffect","useCallback","useRef","useLocation","Link","axios","useNotificacoes","formatDistanceToNow","ptBR","jsxDEV","_jsxDEV","API_BASE_URL","process","env","REACT_APP_API_BASE_URL","pageTitles","Header","_s","location","unreadCount","fetchUnreadCount","isLoadingCount","isDropdownOpen","setIsDropdownOpen","recentNotifications","setRecentNotifications","isLoadingDropdown","setIsLoadingDropdown","dropdownRef","fetchRecentNotifications","token","localStorage","getItem","response","get","headers","notificationsData","data","results","Array","isArray","error","console","toggleDropdown","nextState","handleMarkAllRead","Error","post","_error$response","message","alert","handleClickOutside","event","current","contains","target","document","addEventListener","removeEventListener","formatTempoAtras","dateString","date","Date","addSuffix","locale","e","getPageTitle","title","pathname","path","includes","regexPath","RegExp","replace","test","currentPageTitle","className","children","fileName","_jsxFileName","lineNumber","columnNumber","ref","type","onClick","length","map","notif","mensagem","data_criacao","id_notificacao","to","_c","$RefreshReg$"],"sources":["C:/Users/milen/Desktop/4º ano/projeto/ProjetoDrGus/frontend/src/componentes/Topo.js"],"sourcesContent":["import React, { useState, useEffect, useCallback, useRef } from 'react';\r\nimport { useLocation, Link } from 'react-router-dom';\r\nimport axios from 'axios'; \r\nimport './Topo.css';\r\nimport { useNotificacoes } from '../context/NotificacaoContext'; \r\nimport { formatDistanceToNow } from 'date-fns'; \r\nimport ptBR from 'date-fns/locale/pt-BR'; \r\n\r\nconst API_BASE_URL = process.env.REACT_APP_API_BASE_URL;\r\n\r\n// Mapeamento dos títulos das páginas (ajuste conforme suas rotas)\r\nconst pageTitles = {\r\n    '/inicio': 'Início',\r\n    '/pacientes': 'Pacientes',\r\n    '/patients/new': 'Novo Paciente', // Ajustado para corresponder à rota\r\n    '/patients/:id': 'Detalhes do Paciente', // Mantém o padrão genérico\r\n    '/patients/:id/edit': 'Editar Paciente', // Adicionada rota de edição\r\n    '/agenda': 'Agenda',\r\n    '/orcamentos': 'Orçamentos',\r\n    '/pagamentos': 'Pagamentos',\r\n    '/notificacoes': 'Notificações',\r\n};\r\n\r\nfunction Header() {\r\n    const location = useLocation();\r\n    // Pega dados e funções do Contexto de Notificações\r\n    const { unreadCount, fetchUnreadCount, isLoadingCount } = useNotificacoes();\r\n\r\n    // Estados locais para o dropdown\r\n    const [isDropdownOpen, setIsDropdownOpen] = useState(false);\r\n    const [recentNotifications, setRecentNotifications] = useState([]);\r\n    const [isLoadingDropdown, setIsLoadingDropdown] = useState(false);\r\n\r\n    // Ref para o container do dropdown (para detectar cliques fora)\r\n    const dropdownRef = useRef(null);\r\n\r\n    // Função para buscar as notificações recentes NÃO LIDAS\r\n    const fetchRecentNotifications = useCallback(async () => {\r\n        // Não busca se não houver não lidas ou se já estiver buscando\r\n        if (unreadCount === 0 || isLoadingDropdown) {\r\n            setRecentNotifications([]);\r\n            return;\r\n        }\r\n        setIsLoadingDropdown(true);\r\n        const token = localStorage.getItem('access_token');\r\n        if (!token) { setIsLoadingDropdown(false); return; }\r\n\r\n        try {\r\n            // Busca as X mais recentes não lidas (ex: limit=5)\r\n            const response = await axios.get(`${API_BASE_URL}/api/notificacoes/?lida=false&limit=5`, {\r\n                headers: { 'Authorization': `Bearer ${token}` }\r\n            });\r\n            const notificationsData = response.data.results || (Array.isArray(response.data) ? response.data : []);\r\n            setRecentNotifications(notificationsData);\r\n        } catch (error) {\r\n            console.error(\"Erro ao buscar notificações recentes:\", error);\r\n            setRecentNotifications([]); // Limpa em caso de erro\r\n             // Tratar erro 401 (opcional aqui, já tratado no context)\r\n        } finally {\r\n            setIsLoadingDropdown(false);\r\n        }\r\n    }, [unreadCount, isLoadingDropdown]); // Adicionado isLoadingDropdown como dependência\r\n\r\n    // Função para abrir/fechar o dropdown\r\n    const toggleDropdown = () => {\r\n        const nextState = !isDropdownOpen;\r\n        setIsDropdownOpen(nextState);\r\n        // Busca notificações ao abrir (se houver não lidas)\r\n        if (nextState && unreadCount > 0) {\r\n            fetchRecentNotifications();\r\n        }\r\n    };\r\n\r\n    // Função para marcar todas como lidas\r\n    const handleMarkAllRead = async () => {\r\n        \r\n        // Verifica se há algo para marcar\r\n        if (unreadCount === 0) {\r\n            setIsDropdownOpen(false); // Fecha o dropdown se já estiver vazio\r\n            return;\r\n        }\r\n\r\n        try {\r\n            const token = localStorage.getItem('access_token');\r\n            if (!token) throw new Error(\"Token não encontrado\");\r\n\r\n            // Chama o novo endpoint do backend usando POST\r\n            await axios.post(\r\n                `${API_BASE_URL}/api/notificacoes/marcar-todas-como-lidas/`, \r\n                {}, // Corpo da requisição vazio, pois a ação não precisa de dados extras\r\n                { headers: { 'Authorization': `Bearer ${token}` } }\r\n            ); \r\n            \r\n            // Após sucesso:\r\n            fetchUnreadCount(); // Pede ao Contexto para atualizar a contagem global (deve ir para 0)\r\n            setRecentNotifications([]); // Limpa a lista local no dropdown\r\n            setIsDropdownOpen(false); // Fecha o dropdown\r\n\r\n        } catch (error) {\r\n            console.error(\"Erro ao marcar todas como lidas:\", error.response?.data || error.message);\r\n            alert(\"Erro ao marcar notificações como lidas. Verifique o console.\");\r\n            // Não fecha o dropdown em caso de erro para o usuário ver\r\n        }\r\n    };\r\n\r\n     // Efeito para fechar dropdown ao clicar fora\r\n     useEffect(() => {\r\n         const handleClickOutside = (event) => {\r\n             // Verifica se o clique foi fora do elemento referenciado pelo dropdownRef\r\n             if (dropdownRef.current && !dropdownRef.current.contains(event.target)) {\r\n                 setIsDropdownOpen(false);\r\n             }\r\n         };\r\n         if (isDropdownOpen) {\r\n             document.addEventListener('mousedown', handleClickOutside);\r\n         } else {\r\n             document.removeEventListener('mousedown', handleClickOutside);\r\n         }\r\n         return () => { // Limpeza ao desmontar\r\n             document.removeEventListener('mousedown', handleClickOutside);\r\n         };\r\n     }, [isDropdownOpen]);\r\n\r\n\r\n    // Função para formatar tempo relativo\r\n    const formatTempoAtras = (dateString) => {\r\n         try {\r\n             const date = new Date(dateString);\r\n             return formatDistanceToNow(date, { addSuffix: true, locale: ptBR });\r\n         } catch (e) {\r\n             console.error(\"Erro formatando data:\", dateString, e);\r\n             return dateString;\r\n         }\r\n    };\r\n\r\n    // Função para pegar o título da página (ajustada para rotas dinâmicas)\r\n    const getPageTitle = () => {\r\n        let title = 'DrGus'; // Título padrão\r\n        // Verifica rotas exatas primeiro\r\n        if (pageTitles[location.pathname]) {\r\n            title = pageTitles[location.pathname];\r\n        } else {\r\n            // Verifica rotas com parâmetros (ex: /patients/:id)\r\n            for (const path in pageTitles) {\r\n                if (path.includes(':')) {\r\n                    // Cria uma regex a partir do padrão da rota\r\n                    // Ex: /patients/:id vira /patients/[^/]+\r\n                    const regexPath = new RegExp(`^${path.replace(/:\\w+/g, '[^/]+')}$`);\r\n                    if (regexPath.test(location.pathname)) {\r\n                        title = pageTitles[path];\r\n                        break; // Encontrou, pode parar\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        return title;\r\n    };\r\n    const currentPageTitle = getPageTitle();\r\n\r\n    return (\r\n        <header className=\"app-header-common\">\r\n            <div className=\"page-title\">{currentPageTitle}</div>\r\n\r\n            {/* Ícone de Notificação agora como botão com dropdown */}\r\n            <div className=\"notification-icon-wrapper\" ref={dropdownRef}>\r\n                <button type=\"button\" className=\"notification-icon-button\" onClick={toggleDropdown} aria-label=\"Abrir notificações\" aria-haspopup=\"true\" aria-expanded={isDropdownOpen}>\r\n                    <i className='bx bxs-bell'></i> {/* Ícone do sino */}\r\n                     {/* Badge (mostra se não estiver carregando e houver > 0) */}\r\n                     {!isLoadingCount && unreadCount > 0 && (\r\n                         <span className=\"notification-badge\">{unreadCount > 9 ? '9+' : unreadCount}</span>\r\n                     )}\r\n                </button>\r\n\r\n                {/* O Dropdown */}\r\n                {isDropdownOpen && (\r\n                    <div className=\"notification-dropdown\">\r\n                        <div className=\"dropdown-header\">\r\n                            <span>Notificações Recentes</span>\r\n                            {/* Mostra botão \"Marcar todas\" apenas se houver notificações listadas */}\r\n                            {!isLoadingDropdown && recentNotifications.length > 0 && (\r\n                                <button onClick={handleMarkAllRead} className=\"mark-all-read-button\">\r\n                                    Marcar todas como lidas\r\n                                </button>\r\n                            )}\r\n                        </div>\r\n                        <ul className=\"notification-list\">\r\n                            {isLoadingDropdown ? (\r\n                                <li className=\"notification-item loading\">Carregando...</li>\r\n                            ) : recentNotifications.length > 0 ? (\r\n                                recentNotifications.map(notif => (\r\n                                    <li key={notif.id_notificacao} className=\"notification-item\">\r\n                                            <div className=\"notification-link\"> {/* Div para manter estilo */}\r\n                                                <p className=\"notification-message\">{notif.mensagem}</p>\r\n                                                <span className=\"notification-time\">{formatTempoAtras(notif.data_criacao)}</span>\r\n                                            </div>\r\n                                    </li>\r\n                                ))\r\n                            ) : (\r\n                                <li className=\"notification-item empty\">Nenhuma notificação nova.</li>\r\n                            )}\r\n                        </ul>\r\n                         <div className=\"dropdown-footer\">\r\n                             {/* Link para a página principal de notificações */}\r\n                             <Link to=\"/notificacoes\" onClick={() => setIsDropdownOpen(false)}>\r\n                                 Ver todas as notificações\r\n                             </Link>\r\n                         </div>\r\n                    </div>\r\n                )}\r\n            </div>\r\n        </header>\r\n    );\r\n}\r\n\r\nexport default Header;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}